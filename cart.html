<!DOCTYPE html>
<html>
    <head>
        <title>P2013 Vihrea Stadium team order 2022/11</title>
	    <meta chartset="UTF-8" http-equiv="X-UA-Compatible" name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="cart.css">
		<style></style>
    </head>
    <body>
		<p><img src="images/honkaLogo.png" alt="FC Honka logo" style="float:left;height:40px;"><img src="images/stadiumLogo.webp" alt="Stadium Teamsales logo" style="float:right;height:30px;"></p><br><br><br><br><br>
      	<div class="typing"></div><br>
		
		<div class="cart-card" id="template">
<img class="thumb-image" src="" alt="image">
	
 <div class="names">
 <div class="product-name"></div>
	<div class="item-name"></div>
  </div>
      	<hr id="line" />
  <div class="info">     
	<div class="number"></div>
	  <div class="size"></div>
</div>	  
	<hr id="line" />
	<div class="price"></div>
	<button class="delete-button">üóëÔ∏è</button>

		</div>

 		<div class="total"></div>
  		<div class="small">* You will get an invoice for your order together with the next team fee invoice.</div>
  		<div class="total">Sounds good?</div>
	
	    <div class="buttons">    
			<button id="Submit">Yes. Submit my order!</button>
	    	<button id="BackButton" onclick="window.location='selection.html'+window.location.search;">No. Back to shopping!</button>
		</div>
     
<script>

      let basket = JSON.parse(localStorage.getItem("data")) || [];
	      
      let queryDict = location.search.substr(1).split("=")[1];
      let queryName = queryDict.split("+");
      let fullName = `${queryName[0]} ${queryName[1]}`;
      let greeting = "Here's your order summary for "+fullName+":";
      document.getElementsByClassName("typing")[0].innerHTML = String(greeting);
	
function GenerateCartItems(){
	if (basket.length !== 0) {
    
    let Product = document.getElementById("template");
		
			
    
    for (let i = 0; i < basket.length; i++) {
          let clone = Product.cloneNode(true)
          clone.id = i
	    
	    			function printOption(){
				if (basket[i].print == true) {return "YES";}
				else {return "NO";} };
	    
          clone.getElementsByClassName("thumb-image")[0].src = basket[i].image;
          clone.getElementsByClassName("product-name")[0].innerText = basket[i].product;
          clone.getElementsByClassName("item-name")[0].innerText = basket[i].item;
          clone.getElementsByClassName("number")[0].innerText = "Number print: "+String(printOption());
	  clone.getElementsByClassName("size")[0].innerText = "Selected size: "+String(basket[i].size);
          clone.getElementsByClassName("price")[0].innerText = basket[i].price;
          document.body.append(clone);
    };
    
    	let sum = basket.map(o => o.price2).reduce((a, c) => { return a + c });
	let summary = "You have "+basket.length+" items in your cart. Total: "+(sum).toFixed(2)+" euros. *";

	document.getElementsByClassName("total")[0].innerText = String(summary);
           
	return ; }
	else {document.getElementsByClassName("total")[0].innerText = "Your cart is empty ü§∑";}
};
GenerateCartItems()
	
	document.getElementsByClassName("delete-button")[0].addEventListener("click", function(){
		for (var i = 0, len = basket.length; i < len; i++) {
			delete basket[i];
			localStorage.setItem("data", JSON.stringify(basket));
			basket = JSON.parse(localStorage.getItem("data")) || [];
			GenerateCartItems();
			window.location.reload();
		}});
		
		
		
          document.getElementById("Submit").addEventListener("click", function(){
		for (var i = 0, len = basket.length; i < len; i++) {
			//delete basket[i].image;
			//localStorage.setItem("data", JSON.stringify(basket));
			//basket = JSON.parse(localStorage.getItem("data")) || []; 
			console.log(basket);
			window.location='kiitos.html'+window.location.search;
	
			async function postData(url = 'https://honkap13server.mamathewitch.repl.co/hello', data = basket) {
		  		const response = await fetch(url, {
  					method: 'POST',
  					credentials: 'omit', 
  					headers: {'Content-Type': 'application/json'},
  					body: JSON.stringify(data) } );
					let myJason = await response.json();
		  		return myJason;
			}; // parses JSON response into native JavaScript objects

			postData();
		//  postData().then((data) => {console.log(data); }); // JSON data parsed by `data.json()` call

		 /* localStorage.clear();
		    basket = JSON.parse(localStorage.getItem("data")) || [];
		    GenerateCartItems();
		 	window.location.reload();
		 */
		
		 /*	var x = document.getElementById("snackbar");
              		x.className ="show";
              		setTimeout(function(){x.className = x.className.replace("show", ""); }, 2000);
		*/
		}});          

    //  document.getElementById("cartAmount").innerText = basket.length;
   
</script>
     
</body>

<footer>
      <ul class="nav">
  <li><a href="index.html">1. Select a player | </a></li>
  <li><a href="selection.html">2. Choose products | </a></li>
  <li id=current><a href="cart.html">3. Check and confirm your order</a></li> 
</ul>
</footer>
	
      

</html>
